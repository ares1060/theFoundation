<div id="admin_menu_main">
	<div id="admin_menu_main_nav">
		<ul id="right_action">
<!-- 			<li id="menu_edit"><a href="javascript:void(0);" onclick="tfaddress.editPath({set:{'chapter':'edit'}});" class="menu_link" id="blog_admin_action_settings"><img src="{@pp:abs_root}{@pp:tpl_folder}/img/services/Gallery/edit.png" /><br />Bearbeiten</a></li> -->
<!-- 			<li class="seperator">&nbsp;</li> -->
			<li id="chapter_settings"><a href="javascript:void(0);" onclick="tfaddress.editPath({unset:['action', 'id'], set:{'chapter':'settings'}});" class="menu_link" id="blog_admin_action_settings"><img src="{@pp:abs_root}{@pp:tpl_folder}/img/services/shop/gear_in.png" /><br />Einstellungen</a></li>
		</ul>
		<ul id="chapters">
			<li id="chapter_upload"><a href="javascript:void(0);" onclick="tfaddress.editPath({set:{'chapter':'upload'}});" class="menu_link"><img src="{@pp:abs_root}{@pp:tpl_folder}/img/services/Gallery/upload.png" /><br />Upload</a></li>
			<li class="seperator">&nbsp;</li>
		</ul>
	</div>
</div>
<div class="messages" id="tf_msg">{pp:Messages(action:viewType, type:error/info/debug)}</div>
<div style="position: relative;" id="gallery_main">
	<div id="admin_sidemenu_block">
		<div id="admin_sidemenu">
			<ul>
				<pp:dynamic name="side_menu">
					<li class="menu_album {@pp:moreClass}" id="menu_folder_{@pp:id}">
						<span class="link_line">
							<pp:dynamic name="more">
								<a class="more_spacer" href="javascript:void(0);" onclick="toggleFolder({@pp:id});">
									<img src="{@pp:abs_root}{@pp:tpl_folder}/img/services/gallery/layout/moreArrow.png" class="icon"/>
								</a>
							</pp:dynamic>
							<pp:dynamic name="not_more"><span class="more_spacer">&nbsp;</span></pp:dynamic>
							
							<a href="javascript:void(0);" onclick="tfaddress.editPath({set:{'folder':'{@pp:id}', 'chapter':'main'}}, true);" class="big_link">
								
								<pp:dynamic name="visible"><img src="{@pp:abs_root}{@pp:tpl_folder}/img/services/gallery/icons/album.png" class="icon"/></pp:dynamic>
								<pp:dynamic name="hidden"><img src="{@pp:abs_root}{@pp:tpl_folder}/img/services/gallery/icons/album_hidden.png" class="icon"/></pp:dynamic> 
								
								{@pp:name}
							</a>
						</span>
						{@pp:subfolder}
					</li>
				</pp:dynamic>	
			</ul>
		</div>
	</div>
	
	<div id="admin_image_block">
	Image
	</div>
	
	<div id="admin_bottom_menu">
		<ul>
			<li>
				<a href="javascript:void(0);" class="tf_contextmenu_link"><img src="{@pp:abs_root}{@pp:tpl_folder}/img/services/gallery/layout/new.png" class="menu_item"/></a>
				<span class="tf_contextmenu up" style="position: absolute; left: -4px; top: -80px;">
					<span class="tf_contextmenu_arrow" style="left: 8px;">&nbsp;</span>
					<ul>
						<li class="option"><a href="javascript:void(0);" onclick="alert('new album');">Neues Album</a></li>
						<li class="option"><a href="javascript:void(0);" onclick="alert('new folder');">Neuer Ordner</a></li>
					</ul>						
				</span>
			</li>
			<li class="seperator">&nbsp;</li>
			<li>
				<a href="javascript:void(0);"  onclick="alert('remove selection');"><img src="{@pp:abs_root}{@pp:tpl_folder}/img/services/gallery/layout/remove.png" class="menu_item"/></a>
			</li>
			<li class="seperator">&nbsp;</li>
		</ul>
		<ul style="float: right;">
			<li class="seperator">&nbsp;</li>
			<li>
				<a href="javascript:void(0);" class="tf_contextmenu_link">
					<img src="{@pp:abs_root}{@pp:tpl_folder}/img/services/gallery/layout/settings.png" class="menu_item"/>
				</a>
				<span class="tf_contextmenu up" style="position: absolute; right: -4px; top: -50px;">
					<span class="tf_contextmenu_arrow" style="right: 8px;">&nbsp;</span>
					<ul>
						<li class="option"><a href="javascript:void(0);" onclick="alert('hide folder');">Ordner verstecken</a></li>
					</ul>						
				</span>
			</li>
		</ul>
	</div>
	<div class="clearer">&nbsp;</div>
</div>
<div id="gallery_settings" style="display: none;"></div>
<script type="text/javascript">
	<!--
		var active_page = 1;
		var active_chapter = '';
		var active_action = '';
		var active_folder = {@pp:firstAlbum};
		var active_image = -1;

		/* --- deep link --- */
		$.address.change(function(event) { updateDeeplink(); });  
		$.address.init(function(event) { 
			params = tfaddress.getPathNames();
			
			toggleFolder((params['folder'] == undefined) ? "{@pp:firstAlbum}": params['folder']); 
		});

		function updateDeeplink() {
			params = tfaddress.getPathNames();
			
			if(params['chapter'] == undefined && '{@pp:firstAlbum}' != '-1') { $.address.path('/chapter/main/folder/'+active_folder+'/page/1/'); params = tfaddress.getPathNames();}
			if(params['folder'] == undefined && '{@pp:firstAlbum}' != '-1') { $.address.path('folder', '{@pp:firstAlbum}'); params = tfaddress.getPathNames(); }
			if(params['page'] == undefined && '{@pp:firstAlbum}' != '-1') { $.address.path('page', active_page); params = tfaddress.getPathNames(); }
			
			if(params['chapter'] == undefined && '{@pp:firstAlbum}' == '-1') { $.address.path('/chapter/main/'); params = tfaddress.getPathNames();}
					
			active_page = params['page'];
			active_chapter = params['chapter'];
			active_action= params['action'];
			active_id = params['id'];
			active_folder = params['folder'];
			active_image = params['image'];

			$('#admin_menu_main_nav > ul > li').removeClass('selected');
			
			if(active_chapter == 'main') {

				if(active_folder != undefined && active_folder != -1){
					loadFolder();
				}
				
			} else if(active_chapter == 'upload') { 
				
				loadUpload();
				
			} else if(active_chapter == 'settings') {

				loadSettings();
				
			}
		}
		/* ---------------  Folder --------------*/
		function loadFolder() {
			$('#gallery_main').show();
			$('#gallery_settings').hide();
			
			$('.menu_album > .link_line').removeClass('selected');
			$('.menu_folder > .link_line').removeClass('selected');
			
			var folder = ($('#menu_folder_'+active_folder).size() == 0) ? $('#menu_subfolder_'+active_folder) : $('#menu_folder_'+active_folder);
			
			//toggleFolder(folder)
			
			// TODO: handle action buttons text change (hide / show)
			
			folder.children('.link_line').addClass('selected');
			
			//finally load data from server
			tf.showAdminLoading();
			tf.getService({
				service: 'Gallery', 
				method: 'admin', 
				args: { 
					chapter:'folder',
					page: active_page,
					id: active_folder
				}, 
				handle: function (msg) {
					tf.hideAdminLoading();
					$('#admin_image_block').html(msg);
					tfcontextmenu.update();
				}
			});
		}
		
		function toggleFolder(id) {			
			var folder = ($('#menu_folder_'+id).size() == 0) ? $('#menu_subfolder_'+id) : $('#menu_folder_'+id);

			if(folder != undefined) {
				toggleFolderRec(folder);
			}
		}
		
		var old_folder;
		
		function toggleFolderRec(item) {
			
			if((item.parent().parent().hasClass('menu_folder') && !item.parent().parent().hasClass('open')) ||
				(item.parent().parent().hasClass('menu_album') && !item.parent().parent().hasClass('open'))) {
				
				// recursive folder opening
				toggleFolderRec(item.parent().parent());
			}
			
			if(item.hasClass('more') && item.hasClass('open')) {
				item.removeClass('open');
				item.children('ul').hide();
				item.children('span').children('.more_spacer').children('img').attr('src', '{@pp:abs_root}{@pp:tpl_folder}/img/services/gallery/layout/moreArrow.png');
			} else if(item.hasClass('more')){
				item.addClass('open');
				item.children('ul').show();
				item.children('span').children('.more_spacer').children('img').attr('src', '{@pp:abs_root}{@pp:tpl_folder}/img/services/gallery/layout/moreArrow_rot.png');
			}
		}
		/* ---------------  Upload --------------- */
		function loadUpload() {
			$('#gallery_main').show();
			$('#gallery_settings').hide();
			$('#chapter_upload').addClass('selected');
			tf.showAdminLoading();
			tf.getService({
				service: 'Gallery', 
				method: 'admin', 
				args: { 
					action:'upload'
				}, 
				handle: function (msg) {
						tf.hideAdminLoading();
						alert(msg);
						$('#admin_image_block').html(msg);
					}
			});
		}
		/* ---------------  settings --------------*/
		function loadSettings() {
			$('#chapter_settings').addClass('selected');
			tf.showAdminLoading();
			tf.getService({
				service: 'Gallery', 
				method: 'admin', 
				args: { 
					chapter:'settings'
				}, 
				handle: function (msg) {
						tf.hideAdminLoading();
						$('#gallery_settings').html(msg);
						$('#gallery_main').hide();
						$('#gallery_settings').show();
					}
			});
		}

	//-->
</script>